<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>愉快的做题吧！</title>
    <style>
        b {
            margin-right: 10px;
        }
        
        body {
            margin: 0;
            height: 100vh;
            background: skyblue;
            overflow: hidden;
        }
        
        #box {
            color: #000;
        }
        
        .width {
            display: inline-block;
            width: 33.333%;
            min-width: 246px;
        }
        
        input {
            width: 5em;
        }
        
        .wrap {
            text-align: center
        }
        
        #btn,
        #back {
            display: none;
        }
        
        .time {
            display: none;
            color: yellow;
        }
        
        .boxwrap {
            height: calc(100vh - 18px);
            overflow: auto;
        }
    </style>
</head>

<body>
    <div class="wrap set">
        <input type="text" value="100" class="number">道题<input type="text" value="10" class="minute">分钟完成<br>
        <button id="btn2">生成题目</button>
    </div>
    <div class="time"></div>
    <div class="boxwrap">
        <div id="box">
        </div>
        <div class="wrap">
            <button id="btn">提交答案</button>
            <button id='back'>回到主页</button>
        </div>
    </div>
    <script>
        var number = document.querySelector('.number')
        var minute = document.querySelector('.minute')
        var showtime = document.querySelector('.time')
        var arr = []
        var timer = null

        function set(number, time) {
            arr = []
            while (arr.length < number) {
                var obj = {}
                var res = null
                obj.num1 = Math.round(Math.random() * 99) + 1
                obj.num2 = Math.round(Math.random() * 99) + 1
                obj.num3 = Math.round(Math.random() * 99) + 1
                if (obj.num1 < 10 && obj.num2 < 10) {
                    res += obj.num1 * obj.num2
                    obj.opera = '×'
                } else if (obj.num1 > 9 && obj.num2 != 1 && obj.num2 < 10) {
                    if (obj.num1 % obj.num2 == 0) {
                        res += obj.num1 / obj.num2
                        obj.opera = '÷'
                    }
                } else {
                    if (Math.round(Math.random())) {
                        res += obj.num1 + obj.num2
                        obj.opera = '+'
                    } else {
                        res = obj.num1 - obj.num2
                        obj.opera = '-'
                    }
                }
                if (res != null && res >= 0 && res < 100) {
                    if (obj.num2 < 10 && obj.num3 < 10) {
                        res *= obj.num3
                        obj.opera1 = '×'
                    } else if (res % obj.num3 == 0 && obj.num3 < 10) {
                        res /= obj.num3
                        obj.opera1 = '÷'
                    } else {
                        if (Math.round(Math.random())) {
                            res += obj.num3
                            obj.opera1 = '+'
                        } else {
                            res += -obj.num3
                            obj.opera1 = '-'
                        }
                    }
                    if (res >= 0 && res < 100) {
                        obj.res = res
                        arr.push(obj)
                    }
                }
            }
            var str = ''
            arr.forEach((item, idx) => {
                str += '<span class="width"><b>' + (idx + 1) + '</b>' + '<span>' + item.num1 + '</span>' + '<span>' + item.opera + '</span>' + '<span>' + item.num2 + '</span>' + '<span>' + item.opera1 + '</span>' + '<span>' + item.num3 + '</span>' + '=<input class="user" type="text">' + '<span class="res"></span></span>'
            })
            document.querySelector('.set').style.display = 'none'
            showtime.style.display = 'block'
            btn.style.display = 'inline'
            back.style.display = 'inline'
            showtime.innerHTML = '还剩：' + time + '分钟'
            timer = setInterval(function() {
                showtime.innerHTML = '还剩：' + time.toFixed(2) + '分钟'
                time -= 1 / 60
                if (time <= 0) {
                    clearInterval(timer)
                    check()
                    user1.forEach((item, idx) => {
                        item.setAttribute('disabled', true)
                    })
                }
            }, 1000)
            box.innerHTML = str
            var user1 = document.querySelectorAll('.user')
            user1.forEach((item, idx) => {
                item.addEventListener('keydown', function(e) {
                    if (e.key == 'Enter') {
                        if (idx + 1 < 100) {
                            user1[idx + 1].focus()
                        }
                    }
                })
            })
        }

        function check() {

            var user = document.querySelectorAll('.user')
            var rr = document.querySelectorAll('.res')
            var num = 0
            clearInterval(timer)
            arr.forEach((item, idx) => {
                rr[idx].innerHTML = '答案：' + item.res
                if (item.res != user[idx].value) {
                    user[idx].style.color = 'red'
                    num++
                }
            })
            if (num) {
                alert('本次做错了' + num + '道，继续努力！')
            } else {
                alert('本次全部做对，恭喜！')
            }
        }
        var box = document.querySelector('#box')
        var btn = document.querySelector('#btn')
        var btn2 = document.querySelector('#btn2')
        var back = document.querySelector('#back')
        btn.addEventListener('click', function() {
            check()
        })
        btn2.addEventListener('click', function() {
            var n = Number(number.value)
            var t = Number(minute.value)
            set(n, t)
        })
        back.addEventListener('click', function() {
            box.innerHTML = ''
            clearInterval(timer)
            showtime.innerHTML = ''
            document.querySelector('.set').style.display = 'block'
            btn.style.display = 'none'
            this.style.display = 'none'
        })
    </script>
</body>

</html>